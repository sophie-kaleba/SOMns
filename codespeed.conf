# Config file for ReBench
# Config format is YAML (see http://yaml.org/ for detailed spec)
default_data_file: 'havlak_benchmark.data'
default_experiment: SOMns-native-Havlak

reporting:
    # Benchmark results will be reported to ReBenchDB
    rebenchdb:
        # this url needs to point to the API endpoint
        db_url: https://rebench.stefan-marr.de/rebenchdb
        repo_url: https://github.com/smarr/SOMns
        record_all: true # make sure everything is recorded
        project_name: SOMns

runs:
  min_iteration_time: 5

# definition of benchmark suites
benchmark_suites:
    macro-startup:
        gauge_adapter: RebenchLog
        command: &MACRO_CMD " core-lib/Benchmarks/Harness.ns %(benchmark)s "
        max_invocation_time: 600
        invocations: 3
        benchmarks:
            - CD:
                extra_args: "1 0 2"
                codespeed_name: "1st.CD"
            - Havlak:
                extra_args: "1 0 1"
                codespeed_name: "1st.Havlak"
            - Richards:
                extra_args: "1 0 1"
                codespeed_name: "1st.Richards"
            - RichardsNS:
                extra_args: "1 0 1"
                codespeed_name: "1st.RichardsNS"
            - DeltaBlue:
                extra_args: "1 0 200"
                codespeed_name: "1st.DeltaBlue"
            - DeltaBlueNS:
                extra_args: "1 0 200"
                codespeed_name: "1st.DeltaBlueNS"
            - Mandelbrot:
                extra_args: "1 0 50"
                codespeed_name: "1st.Mandelbrot"
            - NBody:
                extra_args: "1 0 10000"
                codespeed_name: "1st.NBody"
            - Json:
                extra_args: "1 0 2"
                codespeed_name: "1st.Json"
            - GraphSearch:
                extra_args: "1 0 1"
                codespeed_name: "1st.GraphSearch"
            - PageRank:
                extra_args: "1 0 100"
                codespeed_name: "1st.PageRank"
            - Splay:
                extra_args: "1 0 1"
                codespeed_name: "1st.Splay"

    havlak-harness:
        description: Havlak benchmarks - no GC triggered in between each iteration of the benchmark
        gauge_adapter: RebenchLog
        command: *MACRO_CMD
        max_invocation_time: 1200
        benchmarks:
            # last parameter won't trigger GC in Harness
            # [num-iterations] [warm-up] [inner-iter] [num-threads] [gc]
            - Havlak:
                extra_args: "2000 0 8 1 0"
            - HavlakGC:
                extra_args: "2000 0 8 1 0"

    havlak-harnessGC:
        description: Havlak benchmarks - GC triggered in between each iteration of the benchmark
        gauge_adapter: RebenchLog
        command: *MACRO_CMD
        max_invocation_time: 1200
        benchmarks:
            # last parameter will trigger GC in Harness
            # [num-iterations] [warm-up] [inner-iter] [num-threads] [gc]
            - Havlak:
                extra_args: "2000 0 8 1 1"
            - HavlakGC:
                extra_args: "2000 0 8 1 1"


# VMs have a name and are specified by a path and the binary to be executed
executors:
    SOMns-interp:
        path: .
        executable: som
        args: "-G -t1 "
    SOMns-graal:
        path: .
        executable: som
        args: "-t1 "
    # without restricting the number of actor threads
    SOMns-interp-tn:
        path: .
        executable: som
        args: "-G "
    # without restricting the number of actor threads
    SOMns-graal-tn:
        path: .
        executable: som

    # with actor tracing
    SOMns-interp-at:
        path: .
        executable: som
        args: "-G -at -TF "

    SOMns-interp-at-mt:
        path: .
        executable: som
        args: "-G -at -TF -atcfg=mp:pc "

    SOMns-interp-at-mp:
        path: .
        executable: som
        args: "-G -at -TF -atcfg=mt:pc "

    SOMns-interp-at-pc:
        path: .
        executable: som
        args: "-G -at -TF -atcfg=mt:mp "

    SOMns-interp-at-min:
        path: .
        executable: som
        args: "-G -at -TF -atcfg=mt:mp:pc "

    # with actor tracing
    SOMns-graal-at:
        path: .
        executable: som
        args: "-at -TF "

    SOMns-graal-at-mt:
        path: .
        executable: som
        args: "-at -TF -atcfg=mp:pc "

    SOMns-graal-at-mp:
        path: .
        executable: som
        args: "-at -TF -atcfg=mt:pc "

    SOMns-graal-at-pc:
        path: .
        executable: som
        args: "-at -TF -atcfg=mt:mp "

    SOMns-graal-at-min:
        path: .
        executable: som
        args: "-at -TF -atcfg=mt:mp:pc "

    SOMns-native:
        path: .
        executable: som-native

# define the benchmarks to be executed for a re-executable benchmark run
experiments:
    SOMns-native-Havlak:
        description: Run the Havlak benchmark on SOMns native image
        executions:
            - SOMns-native:
                suites:
                  - havlak-harness
                  - havlak-harnessGC

 